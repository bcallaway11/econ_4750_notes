---
output: pdf_document
margin: 1cm
header-includes:
   - \usepackage{amsmath,amssymb,setspace}
   - \newcommand{\E}{\textrm{E}}
---

# Homework 4
## Turn in via ELC Assignments before class on Tuesday April 20

1. Empirical Exercise 11.1 ``In April 2008,...'', **parts a-e only**

    a) 
        ```{r}
        # load the data
        library(haven)
        data <- read_dta("employment_08_09.dta")
  
        # fraction empolyed in April 2009
        # note: an easy way to estimate this and get a confidence interval
        # is to just run a regression on an intercept
        mean_reg <- lm(employed ~ 1, data=data)
        # probability of being employed
        p <- coef(mean_reg)
        round(p,3)
        # 95% ci
        se <- summary(mean_reg)$coefficients[,2]
        ciL <- round(p - 1.96*se,3)
        ciU <- round(p + 1.96*se,3)
        cat("95% CI: [", ciL, ", ", ciU, "]\n")
        ```
	
    b)
    
        ```{r}
        lpm <- lm(employed ~ age + I(age^2), data=data)
        summary(lpm)
        ```
      
        (i) Yes, these results imply that age had a significant effect on the probability of being employed.
      
        (ii) Yes, that the quadratic term is statistically significant suggests that the effect of age is nonlinear.  It is not necessary to have done this, but I think it is helpful to plot predicted employment as a function of $age$.
      
        ```{r}
        possible_ages <- seq(20,65)
        pred_employment <- predict(lpm, newdata=data.frame(age=possible_ages))
        # make the plot
        library(ggplot2)
        # build data to plot
        plot_df <- cbind.data.frame(x=possible_ages, y=pred_employment) 
        ggplot(data=plot_df, mapping=aes(x=x, y=y)) +
        geom_line() +
        ylab("predicted employment") + 
        xlab("age") + 
        theme_bw()
        ```
      
    c)
        ```{r}
        probit_est <- glm(employed ~ age + I(age^2), family=binomial(link=probit),
                          data=data)
        summary(probit_est)
        ```
        Yes, this looks like the effect of age is nonlinear.  It is hard to compare the coefficients directly to the ones from the previous problem, so I'll plot predicted employment from this model as a function of age.
        ```{r}
        probit_employment <- predict(probit_est, newdata=data.frame(age=possible_ages))
        # make the plot
        # build data to plot
        plot_df <- cbind.data.frame(x=possible_ages, y=probit_employment) 
        ggplot(data=plot_df, mapping=aes(x=x, y=y)) +
          geom_line() +
          ylab("predicted employment") + 
          xlab("age") + 
          theme_bw()
        ```
        These predicted probabilities look virtually identical to the previous ones.
      
    d) 
      
        ```{r}
        logit_est <- glm(employed ~ age + I(age^2), family=binomial(link=logit),
                          data=data)
        summary(logit_est)
        ```
      
        Once again, these results suggest that the effect of age is nonlinear.  As before, it is hard to directly compare the coefficient estimates across the linear probability model, probit, and logit; therefore, I plot the predicted probabilities from the logit model next.       
      
        ```{r}
        logit_employment <- predict(logit_est, newdata=data.frame(age=possible_ages))
        # make the plot
        # build data to plot
        plot_df <- cbind.data.frame(x=possible_ages, y=logit_employment) 
        ggplot(data=plot_df, mapping=aes(x=x, y=y)) +
          geom_line() +
          ylab("predicted employment") + 
          xlab("age") + 
          theme_bw()
        ```
      
        Again, these predicted probabilities seem virtually identical to the other models considered in this problem.
      
    e) As noted above, the predicted probabilities are virtually identical across models.  This is despite the fact that the estimated parameters in the models are quite different.  This is not very surprising though as logit, probit, and (often) linear probabilitiy models tend to give similar predicted probabilities (which are of course very closely related to partial effects).
      
2. Review the Concepts 13.2 ``A clinical trial is carried out...''

    You can estimate the treatment effect of the drug by $\widehat{ATT} = \bar{Y}_{D=1} - \bar{Y}_{D=0}$ (in other words, just calculate the average cholesterol of those in the treated group and compare it to the average cholesterol of those in the untreated group).  
  
    If you have additional covariates such as weight, age, and sex of each patient, you could estimate the $ATT$ by running a regression of cholesterol on $D$, weight, age, and sex.  This could lead to a (likely slight) improvement in the estimator.  By construction, none of these variables should be correlated with participating in the treatment (therefore, not including them should, in large samples, not affect the estimate of the $ATT$).  However, in finite samples, it would be possible that, say, more men ended up in the treated group relative to the untreated group.  If sex is correlated with cholesterol, then it would make sense to control for it in the regression.
  
    The same idea would apply to pre-treatment cholesterol level.  It would be reasonable to include it in a regression (though you do not necessarily have to).

3. Use the data, `Birthweight_Smoking.dta`, which is available on ELC, for this question.  Run a regression of `Birthweight` on `Smoker`, `Alcohol`, `Nprevist`, and `Unmarried`.  

    (a) How should you interpret the estimated coefficient on `Smoker` [For this part, just provide a ''partial effect'' interpretation]
    
        ```{r}
        bw_data <- read_dta("birthweight_smoking.dta")
        bw_reg <- lm(birthweight ~ smoker + alcohol + nprevist + unmarried, data=bw_data)
        summary(bw_reg)
        ```
        
        The estimated effect of a mother smoking during pregnancy is that it reduces an infant's birthweight by 175 grams on average, holding alchohol consumption, number of prenatal visits, and whether or not the mother is unmarried constant.  This estimate corresponds to about 5\% lower birthweight which is certainly a notably lower birthweight.
	
    (b) Is the estimated effect statistically significant?  Is it economically significant?
	
	      Yes, the estimated effect is both statistically significant (e.g., the t-statistic is about -6.5).  The size of the effect also seems fairly large in magnitude which suggests that it is "economically" significant.
	      
    (c) Do you think the coefficient on `Smoker` should be interpreted as the causal effect of smoking on birthweight?  Why or why not?

        It certainly seems plausible to believe that smoking could reduce an infant's birthweight, but I would be hesistant to interpret the estimates above as causal effects.  For example, the model's that we estimated do not include mother's age.  It seems plausible to me that mother's age could be correlated both with whether or not a mother smokes as well as have its own effect on infant's birthweight.  Any other variables that (i) affect the outcome and (ii) are correlated with mother's smoking could lead to the same sort of issues as well.