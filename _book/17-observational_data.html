<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Detailed Course Notes for ECON 4750 - 18&nbsp; Causal Inference with Observational Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16-natural_experiments.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="4750_style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./17-observational_data.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Causal Inference with Observational Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Detailed Course Notes for ECON 4750</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Start</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Statistical Programming</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction_to_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-programming_in_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Programming in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Probability</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-random_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-expectations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Expectation, Variance, and More</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Properties of Estimators</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-finite_sample_properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Finite Sample Properties</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-asymptotic_properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Asymptotic Properties</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Regression</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-interpreting_regressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Interpreting Regressions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-regression_computation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Computation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-regression_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Advanced Topics</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-binary_outcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Binary Outcome Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Prediction</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-model_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Causal Inference</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-causal_inference_concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-natural_experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Natural Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-observational_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Causal Inference with Observational Data</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#unconfoundedness" id="toc-unconfoundedness" class="nav-link active" data-scroll-target="#unconfoundedness"><span class="header-section-number">18.1</span> Unconfoundedness</a>
  <ul class="collapse">
  <li><a href="#estimation---regression-adjustment" id="toc-estimation---regression-adjustment" class="nav-link" data-scroll-target="#estimation---regression-adjustment"><span class="header-section-number">18.1.1</span> Estimation - Regression Adjustment</a></li>
  <li><a href="#estimation---regression-under-treatment-effect-homogeneity" id="toc-estimation---regression-under-treatment-effect-homogeneity" class="nav-link" data-scroll-target="#estimation---regression-under-treatment-effect-homogeneity"><span class="header-section-number">18.1.2</span> Estimation - Regression under Treatment Effect Homogeneity</a></li>
  </ul></li>
  <li><a href="#panel-data-approaches" id="toc-panel-data-approaches" class="nav-link" data-scroll-target="#panel-data-approaches"><span class="header-section-number">18.2</span> Panel Data Approaches</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">18.2.1</span> Setup</a></li>
  <li><a href="#using-panel-data-to-validate-assumptions" id="toc-using-panel-data-to-validate-assumptions" class="nav-link" data-scroll-target="#using-panel-data-to-validate-assumptions"><span class="header-section-number">18.2.2</span> Using Panel Data to Validate Assumptions</a></li>
  <li><a href="#using-panel-data-to-make-adjustments" id="toc-using-panel-data-to-make-adjustments" class="nav-link" data-scroll-target="#using-panel-data-to-make-adjustments"><span class="header-section-number">18.2.3</span> Using Panel Data to Make Adjustments</a></li>
  </ul></li>
  <li><a href="#lab-7-minimium-wage-and-employment" id="toc-lab-7-minimium-wage-and-employment" class="nav-link" data-scroll-target="#lab-7-minimium-wage-and-employment"><span class="header-section-number">18.3</span> Lab 7: Minimium Wage and Employment</a></li>
  <li><a href="#lab-7-solution" id="toc-lab-7-solution" class="nav-link" data-scroll-target="#lab-7-solution"><span class="header-section-number">18.4</span> Lab 7: Solution</a></li>
  <li><a href="#coding-questions" id="toc-coding-questions" class="nav-link" data-scroll-target="#coding-questions"><span class="header-section-number">18.5</span> Coding Questions</a></li>
  <li><a href="#extra-questions" id="toc-extra-questions" class="nav-link" data-scroll-target="#extra-questions"><span class="header-section-number">18.6</span> Extra Questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Causal Inference with Observational Data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Unfortunately, we rarely have access to experimental data in applications or the ability to run experiments to evaluate causal effects programs/policies that we’d be interested in studying. For example, it’s hard to imagine convincing a large number of countries to randomly assign their interest rate, minimum wage, or immigration policies though these are all policies that economists would be interested in thinking about the causal effect of. It is also fairly uncommon to have access to the sort of natural experiments that we discussed in the previous chapter. Instead, we often have to make do with <strong>observational data</strong>—data where the treatment is not randomly assigned. In this chapter, we’ll discuss some common approaches to causal inference with observational data.</p>
<section id="unconfoundedness" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="unconfoundedness"><span class="header-section-number">18.1</span> Unconfoundedness</h2>
<p><span class="math display">\[
\newcommand{\E}{\mathbb{E}}
\renewcommand{\P}{\textrm{P}}
\let\L\relax
\newcommand{\L}{\textrm{L}} %doesn't work in .qmd, place this command at start of qmd file to use it
\newcommand{\F}{\textrm{F}}
\newcommand{\var}{\textrm{var}}
\newcommand{\cov}{\textrm{cov}}
\newcommand{\corr}{\textrm{corr}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\Corr}{\mathrm{Corr}}
\newcommand{\sd}{\mathrm{sd}}
\newcommand{\se}{\mathrm{s.e.}}
\newcommand{\T}{T}
\newcommand{\indicator}[1]{\mathbb{1}\{#1\}}
\newcommand\independent{\perp \!\!\! \perp}
\newcommand{\N}{\mathcal{N}}
\]</span></p>
<p>SW 6.8, SW Ch. 9</p>
<p>The approach that we will start with is what is probably the most common approach: <strong>unconfoundedness</strong>.</p>
<p><strong>Unconfoundedness Assumption</strong>: <span class="math display">\[\begin{align*}
  (Y(1),Y(0)) \independent D | X
\end{align*}\]</span> You can think of this as saying that, among individuals with the same covariates <span class="math inline">\(X\)</span>, they have the same distributions of potential outcomes regardless of whether or not they participate in the treatment. Note that the distribution of <span class="math inline">\(X\)</span> is still allowed to be different between the treated and untreated groups. In other words, after you condition on covariates, there is nothing special (in terms of the distributions of potential outcomes) about the group that participates in the treatment relative to the group that doesn’t participate in the treatment.</p>
<ul>
<li>This is potentially a strong assumption. In order to believe this assumption, you need to believe that untreated individuals with the same characteristics can deliver, on average, the outcome that individuals in the treated group would have experienced if they had not participated in the treatment. In math, you can write this as <span class="math display">\[\begin{align*}
    \E[Y(0) | X, D=1] = \E[Y(0) | X, D=0]
  \end{align*}\]</span></li>
</ul>
<p>If you are willing to believe this assumption, then you can recover the <span class="math inline">\(ATT\)</span>. In particular, notice that <span class="math display">\[\begin{align*}
  ATT &amp;= \E[Y(1) - Y(0) \mid D=1] \\
  &amp;= \E\Big[\E[Y(1) - Y(0) \mid X, D=1] \Bigm| D=1\Big] \\
  &amp;= \E\Big[\E[Y(1) \mid X, D=1] - \E[Y(0) \mid X, D=1] \Bigm| D=1\Big] \\
  &amp;= \E\Big[\E[Y(1) \mid X, D=1] - \E[Y(0) \mid X, D=0] \Bigm| D=1\Big] \\
  &amp;= \E\Big[\E[Y \mid X, D=1] - \E[Y \mid X, D=0] \Bigm| D=1\Big]
\end{align*}\]</span> where the first equality is just the law of iterated expectations, the second equality uses the linearity of expectation, the third equality uses unconfoundedness—this is the key step, and the last equality uses the definition of observed outcomes. This final expression only involves observed data, so we can estimate it from data.</p>
<p>The previous expression is quite intuitive. It suggests: (1) finding treated and untreated units that have the same covariates <span class="math inline">\(X\)</span> and comparing their outcomes, (2) then averaging these differences over the distribution of <span class="math inline">\(X\)</span> for treated units.</p>
<section id="estimation---regression-adjustment" class="level3" data-number="18.1.1">
<h3 data-number="18.1.1" class="anchored" data-anchor-id="estimation---regression-adjustment"><span class="header-section-number">18.1.1</span> Estimation - Regression Adjustment</h3>
<p>Next, let’s discuss how to estimate the <span class="math inline">\(ATT\)</span> given the previous expression. I wrote down what I think is the most intuitive expression for the <span class="math inline">\(ATT\)</span> under unconfoundedness above, but we can simplify it in a way that will make estimation easier. In particular, notice that <span class="math display">\[\begin{align*}
  ATT &amp;= \E\Big[\E[Y \mid X, D=1] - \E[Y \mid X, D=0] \Bigm| D=1\Big] \\
  &amp;= \E\Big[\E[Y \mid X, D=1] \mid D=1\Big] - \E\Big[\E[Y \mid X, D=0] \mid D=1\Big] \\
  &amp;= \E[Y \mid D=1] - \E\Big[\E[Y \mid X, D=0] \mid D=1\Big]
\end{align*}\]</span> so that the only complicated part to estimate is <span class="math inline">\(\E[Y \mid X, D=0]\)</span>. We will proceed by using the analogy principle—estimate <span class="math inline">\(\E[Y \mid X, D=0]\)</span>, then average the predicted values.</p>
<p><strong>Step 1: Regression using Untreated Units</strong></p>
<ul>
<li>Estimate a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> using only untreated units (i.e., those with <span class="math inline">\(D=0\)</span>), and recover predicted values from this regression, which we will denote <span class="math inline">\(\hat{Y}_i^{(0)}\)</span> for each unit <span class="math inline">\(i\)</span>.</li>
</ul>
<p><strong>Step 2: Average Predicted Values for Treated Units</strong></p>
<p>Our estimator for <span class="math inline">\(ATT\)</span> will be</p>
<p><span class="math display">\[\begin{align*}
  \widehat{ATT} &amp;= \bar{Y}_{D=1} - \frac{1}{n_1} \sum_{i=1}^n D_i \hat{Y}_i^{(0)}
\end{align*}\]</span> where <span class="math inline">\(\bar{Y}_{D=1}\)</span> is the average outcome for treated units, <span class="math inline">\(n_1\)</span> is the number of treated units, and the sum is over all units but only includes predicted values for treated units (because of the <span class="math inline">\(D_i\)</span> term).</p>
<p>Because we estimate a first-step regression and then average, the approach discussed above is called <strong>regression adjustment</strong>.</p>
<p><strong>Code</strong></p>
<p>My favorite package for implementing regression adjustment is the <code>DRDID</code> package. This is a package that is built for using panel data, but we can “trick” it into doing cross-sectional regression adjustment. The code below shows how to do this. Suppose that we have a data frame <code>df</code> with outcome variable <code>Y</code>, treatment variable <code>D</code>, and covariates <code>X1</code>, <code>X2</code>, and <code>X3</code>. The</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DRDID)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>Y</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> df<span class="sc">$</span>D</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> X1 <span class="sc">+</span> X2 <span class="sc">+</span> X3, <span class="at">data =</span> df) <span class="co"># create matrix of covariates</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>ra_att <span class="ot">&lt;-</span> DRDID<span class="sc">::</span><span class="fu">reg_did_panel</span>(<span class="at">y1 =</span> y, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">D =</span> D, <span class="at">covariates =</span> X)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ra_att</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>DRDID::reg_did_panel</code> expects outcomes for two periods: period 1 and period 0, but our trick is to just set the period 0 outcomes to zero for everyone (i.e., <code>y0 = 0</code>). The function will then estimate the regression adjustment estimator for us. Note that you can include any covariates you want in the regression by changing the formula in <code>model.matrix</code>.</p>
</section>
<section id="estimation---regression-under-treatment-effect-homogeneity" class="level3" data-number="18.1.2">
<h3 data-number="18.1.2" class="anchored" data-anchor-id="estimation---regression-under-treatment-effect-homogeneity"><span class="header-section-number">18.1.2</span> Estimation - Regression under Treatment Effect Homogeneity</h3>
<p>Although I prefer the regression adjustment approach above, it is more common to try to estimate the causal effect of <span class="math inline">\(D\)</span> using a single regression.</p>
<p>We will make two additional assumptions here. First, we will make the <strong>treatment effect homogeneity assumption</strong> that we have discussed before: <span class="math inline">\(Y_i(1) - Y_i(0) = \alpha\)</span> for all <span class="math inline">\(i\)</span>. Second, we will assume a linear model for untreated potential outcomes: <span class="math display">\[\begin{align*}
  Y(0) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + U
\end{align*}\]</span> where, for simplicity, I have assumed that there are only two covariates, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>. Next, notice that unconfoundedness implies that <span class="math inline">\(\E[U|X_1,X_2,D] = 0\)</span> (the conditioning on <span class="math inline">\(D\)</span> is the unconfoundedness part). Now, recalling the definition of the observed outcome, we can write <span class="math display">\[\begin{align*}
  Y_i &amp;= D_i Y_i(1) + (1-D_i) Y_i(0) \\
  &amp;= D_i (Y_i(1) - Y_i(0)) + Y_i(0) \\
  &amp;= \alpha D_i + \beta_0 + \beta_1 X_1 + \beta_2 X_2 + U_i
\end{align*}\]</span> which suggests running the regression of observed <span class="math inline">\(Y\)</span> on <span class="math inline">\(X_1,X_2,\)</span> and <span class="math inline">\(D\)</span> and interpreting the estimate of <span class="math inline">\(\alpha\)</span> as the causal effect of participating in the treatment. In practice, this will be very similar to what we have done before — so the process would not be hard, but convincing someone (or even yourself) that unconfoundedness holds will be the bigger issue here.</p>
<p>As a final comment, the assumption of treatment effect homogeneity is not quite so innocuous here. It turns out that you can show that, in the presence of treatment effect heterogeneity, <span class="math inline">\(\alpha\)</span> will be equal to a weighted average of individual treatment effects, but the weights can sometimes be “strange”. There are methods that are robust to treatment effect heterogeneity (they are beyond the scope of the current class, but they are not “way” more difficult than what we are doing here). That said, in my experience, the regression estimators (under treatment effect homogeneity) tend to deliver similar estimates to alternative estimators that are robust to treatment effect heterogeneity at least in the setup considered in this section.</p>
</section>
</section>
<section id="panel-data-approaches" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="panel-data-approaches"><span class="header-section-number">18.2</span> Panel Data Approaches</h2>
<p>SW All of Ch. 10 and 13.4</p>
<p>In this section, we’ll consider the case where a researcher has access to a different type of data called <strong>panel data</strong>. Panel data is data that follows the same individual (or firm, etc.) over time. In this case, it is often helpful to index variables by time. For example, <span class="math inline">\(Y_{it}\)</span> is the outcome for individual <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span>. <span class="math inline">\(X_{it}\)</span> is the value of a regressor for individual <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span> and <span class="math inline">\(D_{it}\)</span> is the value of the treatment for individual <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span>. If some variable doesn’t vary over time (e.g., a regressor like race), we won’t use a <span class="math inline">\(t\)</span> subscript.</p>
<section id="setup" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">18.2.1</span> Setup</h3>
<p>For this section, we will consider a setting where a researcher observes exactly two periods of panel data, <span class="math inline">\(t=1\)</span> and <span class="math inline">\(t=2\)</span>. We will also suppose that, in the first period, no units are treated (i.e., <span class="math inline">\(D_{i1} = 0\)</span> for all <span class="math inline">\(i\)</span>) while in the second period, some units are treated (i.e., <span class="math inline">\(D_{i2}\)</span> can be either 0 or 1). In this setting, it will be more convenient to work with the “group” variable, <span class="math inline">\(G_i\)</span>, which indicates whether or not individual <span class="math inline">\(i\)</span> participates in the treatment in the second period. Slightly updating notation, we will be interested in <span class="math inline">\(ATT = \E[Y_{t=2}(1) - Y_{t=2}(0) | G=1]\)</span> which is the average treatment effect in period 2 for the treated group. The setup discussed here is sometimes referred to as a “pre-post” design because we have a “pre-treatment” period (period 1) and a “post-treatment” period (period 2).</p>
</section>
<section id="using-panel-data-to-validate-assumptions" class="level3" data-number="18.2.2">
<h3 data-number="18.2.2" class="anchored" data-anchor-id="using-panel-data-to-validate-assumptions"><span class="header-section-number">18.2.2</span> Using Panel Data to Validate Assumptions</h3>
<p>The first major use of panel data is to try check/validate identification assumptions. Recall that, one of the main challenges that we faced with unconfoundedness was that it is hard to convince yourself or others that unconfoundedness holds. Panel data can help with this as we can effectively check if unconfoundedness holds in the pre-treatment period.</p>
<p>The main implication of unconfoundedness that we used above was that we could learn about untreated potential outcomes for the treated group by looking at untreated units with the same covariates. In the pre-treatment period, no one is treated, so we can actually check if this implication holds in the pre-treatment period. That is, <span class="math display">\[\begin{align*}
  \E[Y_{t=1} | G=1] \stackrel{?}{=} \E\Big[ \E[Y_{t=1} | X, G=0] \Bigm| G=1 \Big]
\end{align*}\]</span> If unconfoundedness holds in the first period, then these should be equal, and if they are unequal, that is evidence against unconfoundedness holding. If you squint at this, you can see that <span class="math inline">\(\E[Y_{t=1} | G=1] - \E\Big[ \E[Y_{t=1} | X, G=0] \Bigm| G=1 \Big]\)</span> is exactly the estimand that we would use for the <span class="math inline">\(ATT\)</span> if the treatment had been implemented in period 1. Thus, we can basically implement our estimator in the pre-treatment period and check to see if we get something close to zero (implying that unconfoundedness held in period 1) or not (implying that unconfoundedness is violated in period 1). In the first case, it seems reasonable to hope that unconfoundness might hold in period 2, while in the second case, it provides a strong piece of evidence against unconfoundedness holding in period 2. Because we implement the same estimator in the pre-treatment period as we would in the post-treatment period, this approach is sometimes called a <strong>placebo test</strong>.</p>
<p>In my view, being able to implement this sort of placebo test is the most important feature of using panel data for causal inference. That said, I should mention that this does not guarantee that we will get reliable estimates in post-treatment periods. We really need unconfoundedness to hold in the post-treatment period, not necessarily in the pre-treatment period. Still, it seems like in most applications, this is about as good evidence as you could have about the plausibility of unconfoundedness.</p>
</section>
<section id="using-panel-data-to-make-adjustments" class="level3" data-number="18.2.3">
<h3 data-number="18.2.3" class="anchored" data-anchor-id="using-panel-data-to-make-adjustments"><span class="header-section-number">18.2.3</span> Using Panel Data to Make Adjustments</h3>
<p>Besides validating assumptions, the other main use case for panel data is to adjust for certain things that would typically be unobserved if we did not have panel data. We will consider two versions of this.</p>
<section id="lagged-outcome-unconfoundedness" class="level4" data-number="18.2.3.1">
<h4 data-number="18.2.3.1" class="anchored" data-anchor-id="lagged-outcome-unconfoundedness"><span class="header-section-number">18.2.3.1</span> Lagged Outcome Unconfoundedness</h4>
<p>Probably the most straightforward thing that we can do with panel data that is unavailable with cross-sectional data is to assume unconfoundedness holds after conditioning on lagged outcomes. That is, <span class="math display">\[\begin{align*}
  \big(Y_{t=2}(1), Y_{t=2}(0)\big) \independent G | \big(X, Y_{t=1}\big)
\end{align*}\]</span> Using exactly the same arguments as for unconfoundedness above, it immediately follows that <span class="math display">\[\begin{align*}
  ATT &amp;= \E\Big[ \E[Y_{t=2} | X, Y_{t=1}, G=1] - \E[Y_{t=2} | X, Y_{t=1}, G=0] \Bigm| G=1 \Big]
\end{align*}\]</span> In other words, to recover the <span class="math inline">\(ATT\)</span>, we simply need to find treated and untreated units that have the same characteristics <span class="math inline">\(X\)</span> and the same pre-treatment outcome <span class="math inline">\(Y_{t=1}\)</span>, compare their outcomes in period 2, and then average all of these differences.</p>
<p>Estimation is exactly the same as for unconfoundedness above; just make sure to include <span class="math inline">\(Y_{t=1}\)</span> as one of the covariates in the regression adjustment or regression approach.</p>
</section>
<section id="difference-in-differences" class="level4" data-number="18.2.3.2">
<h4 data-number="18.2.3.2" class="anchored" data-anchor-id="difference-in-differences"><span class="header-section-number">18.2.3.2</span> Difference-in-Differences</h4>
<p>While adding lagged outcomes to the unconfoundedness assumption seems very natural, difference-in-differences is an alternative approach to making adjustments that is more popular among economists.</p>
<p>In the previous section, we invoked the assumption of unconfoundedness and were in the setup where <span class="math inline">\(X\)</span> was fully observed. But suppose instead that you thought this alternative version of unconfoundedness held <span class="math display">\[\begin{align*}
  \big(Y(1),Y(0)\big) \independent D | \big(X,W\big)
\end{align*}\]</span> where <span class="math inline">\(X\)</span> were observed random variables, but <span class="math inline">\(W\)</span> were not observed.</p>
<p>Let us also maintain the assumption of a linear model for untreated potential outcomes: <span class="math display">\[\begin{align*}
  Y_t(0) = \beta_0 + \beta_1 X + \beta_2 W + U
\end{align*}\]</span> Unconfoundedness continues to imply that <span class="math inline">\(\E[U|D] = 0\)</span> (i.e., that the error terms are not systematically different between the groups). Previously, this expression led to a regression adjustment estimator of <span class="math inline">\(ATT\)</span>, but now that approach is infeasible because <span class="math inline">\(W\)</span> is not observed. However, notice that, with panel data, we can write this model for both time periods: <span class="math display">\[\begin{align*}
  Y_{t=2}(0) = \beta_0 + \beta_1 X + \beta_2 W + U_{t=2} \\
  Y_{t=1}(0) = \beta_0 + \beta_1 X + \beta_2 W + U_{t=1}
\end{align*}\]</span> Subtracting the second equation from the first gives <span class="math display">\[\begin{align*}
  \Delta Y(0) = \Delta U
\end{align*}\]</span> which implies that <span class="math inline">\(\E[\Delta Y(0) | D] = 0\)</span> (i.e., untreated potential outcomes do not systematically change over time).</p>
<p>Now, let us use this to recover the <span class="math inline">\(ATT\)</span>: <span class="math display">\[\begin{align*}
  ATT &amp;= \E[Y_{t=2}(1) - Y_{t=2}(0) | D=1] \\
      &amp;= \E[Y_{t=2} | D=1] - \Big(\E[Y_{t=2}(0) | D=1] - \E[Y_{t=1}(0) | D=1]\Big) - \E[Y_{t=1}(0) | D=1] \\
      &amp;= \E[Y_{t=2} | D=1] - \Big(\underbrace{\E[\Delta Y(0) | D=1]}_{=0}\Big) - \E[Y_{t=1} | D=1] \\
      &amp;= \E[Y_{t=2} | D=1] - \E[Y_{t=1} | D=1]
\end{align*}\]</span> In other words, in the setup above, the <span class="math inline">\(ATT\)</span> is just equal to the average post-treatment outcome for the treated group relative to the average pre-treatment outcome for the treated group. This is called a <strong>before-after</strong> identification strategy, and it is actually quite intuitive: we are effectively comparing each treated unit’s outcome after treatment to its outcome before it participated in the treatment.</p>
<p>In practice, it is common to slightly generalize this approach. In fact, I pulled a little bit of trick on you earlier. Probably a more appropriate linear model for untreated potential outcomes is: <span class="math display">\[\begin{align*}
  Y_t(0) = \beta_{0,t} + \beta_{1,t} X + \beta_{2,t} W + U_t
\end{align*}\]</span> where we allow the intercept and the effects of <span class="math inline">\(X\)</span> and <span class="math inline">\(W\)</span> on untreated potential outcomes to vary over time. In this case, we can follow exactly the same steps as above to get <span class="math display">\[\begin{align*}
  Y_{t=2}(0) &amp;= \beta_{0,t=2} + \beta_{1,t=2} X + \beta_{2,t=2} W + U_{t=2} \\
  Y_{t=1}(0) &amp;= \beta_{0,t=1} + \beta_{1,t=1} X + \beta_{2,t=1} W + U_{t=1}
\end{align*}\]</span> Subtracting the second equation from the first gives <span class="math display">\[\begin{align*}
  \Delta Y(0) = \Delta \beta_0 + \Delta \beta_1 X + \Delta \beta_2 W + \Delta U
\end{align*}\]</span> This still presents a bit of a problem as <span class="math inline">\(W\)</span> is still unobserved. In particular, we need one more assumption—the effect of <span class="math inline">\(W\)</span> is constant over time, i.e., <span class="math inline">\(\beta_{2,t=2} = \beta_{2,t=1}\)</span> so that <span class="math inline">\(\Delta \beta_2 = 0\)</span>. In this case, we have that <span class="math display">\[\begin{align*}
  \Delta Y(0) = \Delta \beta_0 + \Delta \beta_1 X + \Delta U
\end{align*}\]</span> since <span class="math inline">\(\E[\Delta U | X, D] = 0\)</span> (by the version of unconfoundedness we have considered in this section), it follows that <span class="math display">\[\begin{align*}
  \E[\Delta Y(0) | X, D=1] = \E[\Delta Y(0) | X, D=0]
\end{align*}\]</span> This condition is called the <strong>parallel trends assumption</strong> because it says that, after conditioning on <span class="math inline">\(X\)</span>, the untreated potential outcomes for the treated and untreated groups would have followed the same trend over time. Under this assumption, we can recover the <span class="math inline">\(ATT\)</span> as follows: <span class="math display">\[\begin{align*}
  ATT &amp;= \E[Y_{t=2}(1) - Y_{t=2}(0) | D=1] \\
      &amp;= \E[Y_{t=2}(1) - Y_{t=1}(0) | D=1] - \E[Y_{t=2}(0) - Y_{t=1}(0) | D=1] \\
      &amp;= \E\Big[ \E[Y_{t=2} - Y_{t=1} | X, D=1] - \E[Y_{t=2}(0) - Y_{t=1}(0) | X, D=1] \Bigm| D=1 \Big] \\
      &amp;= \E\Big[ \E[Y_{t=2} - Y_{t=1} | X, D=1] - \E[Y_{t=2} - Y_{t=1} | X, D=0] \Bigm| D=1 \Big] \\
\end{align*}\]</span> which follows essentially the same argument as for unconfoundedness after we take differences in the second equation. This suggests the following estimation approach: regression adjustment but where the outcome variable is <span class="math inline">\(\Delta Y\)</span> rather than <span class="math inline">\(Y\)</span>. This approach is called <strong>difference-in-differences</strong> because it involves taking differences over time to eliminate unobserved, time invariant variables, and then taking differences between treated and untreated groups to recover the causal effect. It is very popular in empirical work in economics.</p>
</section>
</section>
</section>
<section id="lab-7-minimium-wage-and-employment" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="lab-7-minimium-wage-and-employment"><span class="header-section-number">18.3</span> Lab 7: Minimium Wage and Employment</h2>
<p>For this lab, we will use the <code>njmin</code> data from the <code>causaldata</code> package. This is data that comes from Card and Krueger (1994), which is one of the most well-known empirical papers in all of economics. It is about the causal effect of a minimum wage increase in New Jersey on employment in the fast food industry. It is one of the original difference-in-differences papers and is also, as far as I know, one of the first papers to explicitly use the pre-post research design that we discussed above.</p>
<p>To start with, use the following code to load the data, drop rows with missing data, and drop columns that we won’t use in this lab.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/fastfood.RData"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>fastfood <span class="ot">&lt;-</span> <span class="fu">subset</span>(fastfood, balanced <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># drop unused columns</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>fastfood <span class="ot">&lt;-</span> <span class="fu">select</span>(fastfood, id, state, location, chain_name, ownership, fte_pre, hrsopen_pre, wage_st_pre, fte_post, hrsopen_post, wage_st_post)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Use <code>modelsummary::datasummary_balance</code> to report summary statistics for all the variables in the data, separately by state (New Jersey vs.&nbsp;Pennsylvania). What do you notice?</p></li>
<li><p>Let us start by assuming unconfoundedness conditional on the restaurant chain (<code>chain_name</code>). Estimate the <span class="math inline">\(ATT\)</span> of the minimum wage on full-time equivalent employees in the post-treatment period using (1) regression adjustment and (2) using a single regression. Report your estimates and interpret them.</p></li>
<li><p>Implement the placebo test for unconfoundedness in the pre-treatment period using both regression adjustment and using a single regression. What do you find, and what does it suggest about the plausibility of unconfoundedness in this application?</p></li>
<li><p>Let us change the identification strategy to lagged outcome unconfoundedness (let’s continue to also include <code>chain_name</code> as a covariate). Estimate the <span class="math inline">\(ATT\)</span> of the minimum wage on full-time equivalent employees in the post-treatment period using lagged outcome unconfoundedness using (1) regression adjustment and (2) using a single regression.</p></li>
<li><p>Finally, estimate the <span class="math inline">\(ATT\)</span> of the minimum wage on full-time equivalent employees in the post-treatment period using difference-in-differences, continuing to include <code>chain_name</code> as a covariate, using (1) regression adjustment and (2) using a single regression. How do your results compare to the previous two estimates?</p></li>
</ol>
</section>
<section id="lab-7-solution" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="lab-7-solution"><span class="header-section-number">18.4</span> Lab 7: Solution</h2>
<ol type="1">
<li>Summary statistics by state</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_balance</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>state,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> fastfood,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_oeb7bltwj5be96sm6u5v(i, j, css_id) {
          var table = document.getElementById("tinytable_oeb7bltwj5be96sm6u5v");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_oeb7bltwj5be96sm6u5v');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_oeb7bltwj5be96sm6u5v(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_oeb7bltwj5be96sm6u5v");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 0, j: 7 }, { i: 0, j: 5 }, { i: 0, j: 4 }, { i: 0, j: 6 },  ], css_id: 'tinytable_css_zrh1q962mhy04a4yq1nq',}, 
          { positions: [ { i: 20, j: 2 }, { i: 20, j: 4 }, { i: 20, j: 3 }, { i: 20, j: 6 }, { i: 20, j: 5 }, { i: 20, j: 7 },  ], css_id: 'tinytable_css_cbm2zlvk7z3cuof9yz9h',}, 
          { positions: [ { i: 8, j: 4 }, { i: 8, j: 3 }, { i: 8, j: 5 }, { i: 8, j: 2 }, { i: 8, j: 7 }, { i: 8, j: 6 },  ], css_id: 'tinytable_css_phnwjbvufq3bu90vflpw',}, 
          { positions: [ { i: 3, j: 2 }, { i: 7, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 11, j: 2 }, { i: 13, j: 2 }, { i: 14, j: 2 }, { i: 15, j: 2 }, { i: 16, j: 2 }, { i: 17, j: 2 }, { i: 18, j: 2 }, { i: 19, j: 2 }, { i: 18, j: 4 }, { i: 6, j: 4 }, { i: 9, j: 2 }, { i: 10, j: 2 }, { i: 3, j: 3 }, { i: 12, j: 2 }, { i: 5, j: 3 }, { i: 6, j: 3 }, { i: 7, j: 3 }, { i: 6, j: 5 }, { i: 9, j: 3 }, { i: 10, j: 3 }, { i: 11, j: 3 }, { i: 12, j: 3 }, { i: 13, j: 3 }, { i: 14, j: 3 }, { i: 15, j: 3 }, { i: 16, j: 3 }, { i: 17, j: 3 }, { i: 18, j: 3 }, { i: 19, j: 3 }, { i: 18, j: 5 }, { i: 2, j: 2 }, { i: 18, j: 7 }, { i: 4, j: 2 }, { i: 3, j: 4 }, { i: 4, j: 4 }, { i: 5, j: 4 }, { i: 4, j: 6 }, { i: 7, j: 4 }, { i: 6, j: 6 }, { i: 9, j: 4 }, { i: 10, j: 4 }, { i: 11, j: 4 }, { i: 12, j: 4 }, { i: 13, j: 4 }, { i: 14, j: 4 }, { i: 15, j: 4 }, { i: 16, j: 4 }, { i: 17, j: 4 }, { i: 16, j: 6 }, { i: 19, j: 4 }, { i: 18, j: 6 }, { i: 2, j: 3 }, { i: 14, j: 5 }, { i: 4, j: 3 }, { i: 3, j: 5 }, { i: 4, j: 5 }, { i: 5, j: 5 }, { i: 4, j: 7 }, { i: 7, j: 5 }, { i: 6, j: 7 }, { i: 9, j: 5 }, { i: 10, j: 5 }, { i: 11, j: 5 }, { i: 12, j: 5 }, { i: 13, j: 5 }, { i: 19, j: 6 }, { i: 15, j: 5 }, { i: 16, j: 5 }, { i: 17, j: 5 }, { i: 16, j: 7 }, { i: 19, j: 5 }, { i: 12, j: 6 }, { i: 2, j: 4 }, { i: 14, j: 6 }, { i: 2, j: 6 }, { i: 3, j: 6 }, { i: 17, j: 6 }, { i: 5, j: 6 }, { i: 11, j: 7 }, { i: 7, j: 6 }, { i: 2, j: 5 }, { i: 9, j: 6 }, { i: 10, j: 6 }, { i: 11, j: 6 }, { i: 17, j: 7 }, { i: 13, j: 6 }, { i: 19, j: 7 }, { i: 15, j: 6 }, { i: 12, j: 7 }, { i: 9, j: 7 }, { i: 10, j: 7 }, { i: 2, j: 7 }, { i: 3, j: 7 }, { i: 13, j: 7 }, { i: 14, j: 7 }, { i: 7, j: 7 }, { i: 5, j: 7 }, { i: 15, j: 7 },  ], css_id: 'tinytable_css_yt2nyf3wvc8rtihfk6bi',}, 
          { positions: [ { i: 0, j: 2 }, { i: 0, j: 3 },  ], css_id: 'tinytable_css_j2fs1m5ry0t1plbt63mu',}, 
          { positions: [ { i: 1, j: 2 }, { i: 1, j: 4 }, { i: 1, j: 6 }, { i: 1, j: 5 }, { i: 1, j: 3 }, { i: 1, j: 7 },  ], css_id: 'tinytable_css_83mt319xpkfuh6fudklu',}, 
          { positions: [ { i: 20, j: 0 }, { i: 20, j: 1 },  ], css_id: 'tinytable_css_uhivcglyoectv29rylih',}, 
          { positions: [ { i: 8, j: 1 }, { i: 8, j: 0 },  ], css_id: 'tinytable_css_plvdv38ge6ar4fi8sdh3',}, 
          { positions: [ { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 10, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 14, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 18, j: 0 }, { i: 19, j: 0 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 9, j: 0 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 16, j: 1 }, { i: 9, j: 1 }, { i: 10, j: 1 }, { i: 11, j: 1 }, { i: 17, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 },  ], css_id: 'tinytable_css_vtx2p5fgbiu11hy62gm0',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 1 },  ], css_id: 'tinytable_css_c68ym8g7b9d1qxonqoa0',}, 
          { positions: [ { i: 1, j: 0 }, { i: 1, j: 1 },  ], css_id: 'tinytable_css_3m8x6p8zzk8melf38bz0',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_oeb7bltwj5be96sm6u5v(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_zrh1q962mhy04a4yq1nq, .table th.tinytable_css_zrh1q962mhy04a4yq1nq { text-align: right; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; }
      .table td.tinytable_css_cbm2zlvk7z3cuof9yz9h, .table th.tinytable_css_cbm2zlvk7z3cuof9yz9h { text-align: right; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_phnwjbvufq3bu90vflpw, .table th.tinytable_css_phnwjbvufq3bu90vflpw { text-align: right; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_yt2nyf3wvc8rtihfk6bi, .table th.tinytable_css_yt2nyf3wvc8rtihfk6bi { text-align: right; }
      .table td.tinytable_css_j2fs1m5ry0t1plbt63mu, .table th.tinytable_css_j2fs1m5ry0t1plbt63mu { text-align: right; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_83mt319xpkfuh6fudklu, .table th.tinytable_css_83mt319xpkfuh6fudklu { text-align: right; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_uhivcglyoectv29rylih, .table th.tinytable_css_uhivcglyoectv29rylih { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_plvdv38ge6ar4fi8sdh3, .table th.tinytable_css_plvdv38ge6ar4fi8sdh3 { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_vtx2p5fgbiu11hy62gm0, .table th.tinytable_css_vtx2p5fgbiu11hy62gm0 { text-align: left; }
      .table td.tinytable_css_c68ym8g7b9d1qxonqoa0, .table th.tinytable_css_c68ym8g7b9d1qxonqoa0 { text-align: left; text-align: center; border-top: solid #d3d8dc 0.1em; text-align: center; }
      .table td.tinytable_css_3m8x6p8zzk8melf38bz0, .table th.tinytable_css_3m8x6p8zzk8melf38bz0 { text-align: left; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_oeb7bltwj5be96sm6u5v" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
<tr>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="2">Pennsylvania (N=75)</th>
<th scope="col" align="center" colspan="2">New Jersey (N=309)</th>
<th scope="col" align="center" colspan="1"> </th>
<th scope="col" align="center" colspan="1"> </th>
</tr>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">  </th>
                <th scope="col">Mean</th>
                <th scope="col">Std. Dev.</th>
                <th scope="col">Mean</th>
                <th scope="col">Std. Dev.</th>
                <th scope="col">Diff. in Means</th>
                <th scope="col">Std. Error</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>id</td>
                  <td></td>
                  <td>3776.93</td>
                  <td>1805.12</td>
                  <td>2176.01</td>
                  <td>1209.22</td>
                  <td>-1600.92</td>
                  <td>219.50</td>
                </tr>
                <tr>
                  <td>fte_pre</td>
                  <td></td>
                  <td>23.38</td>
                  <td>12.01</td>
                  <td>20.43</td>
                  <td>9.21</td>
                  <td>-2.95</td>
                  <td>1.48</td>
                </tr>
                <tr>
                  <td>hrsopen_pre</td>
                  <td></td>
                  <td>14.51</td>
                  <td>2.96</td>
                  <td>14.40</td>
                  <td>2.82</td>
                  <td>-0.12</td>
                  <td>0.38</td>
                </tr>
                <tr>
                  <td>wage_st_pre</td>
                  <td></td>
                  <td>4.63</td>
                  <td>0.36</td>
                  <td>4.61</td>
                  <td>0.34</td>
                  <td>-0.02</td>
                  <td>0.05</td>
                </tr>
                <tr>
                  <td>fte_post</td>
                  <td></td>
                  <td>21.10</td>
                  <td>8.38</td>
                  <td>20.90</td>
                  <td>9.38</td>
                  <td>-0.20</td>
                  <td>1.10</td>
                </tr>
                <tr>
                  <td>hrsopen_post</td>
                  <td></td>
                  <td>14.64</td>
                  <td>2.88</td>
                  <td>14.39</td>
                  <td>2.76</td>
                  <td>-0.25</td>
                  <td>0.37</td>
                </tr>
                <tr>
                  <td>wage_st_post</td>
                  <td></td>
                  <td>4.62</td>
                  <td>0.36</td>
                  <td>5.08</td>
                  <td>0.10</td>
                  <td>0.46</td>
                  <td>0.04</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>N</td>
                  <td>Pct.</td>
                  <td>N</td>
                  <td>Pct.</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>location</td>
                  <td>NJ_Central</td>
                  <td>0</td>
                  <td>0.0</td>
                  <td>58</td>
                  <td>18.8</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>NJ_North</td>
                  <td>0</td>
                  <td>0.0</td>
                  <td>162</td>
                  <td>52.4</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>NJ_South</td>
                  <td>0</td>
                  <td>0.0</td>
                  <td>89</td>
                  <td>28.8</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>PA_Easton</td>
                  <td>41</td>
                  <td>54.7</td>
                  <td>0</td>
                  <td>0.0</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>PA_PhillyNE</td>
                  <td>34</td>
                  <td>45.3</td>
                  <td>0</td>
                  <td>0.0</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>chain_name</td>
                  <td>Burger King</td>
                  <td>33</td>
                  <td>44.0</td>
                  <td>126</td>
                  <td>40.8</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>KFC</td>
                  <td>12</td>
                  <td>16.0</td>
                  <td>67</td>
                  <td>21.7</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>Roy Rogers</td>
                  <td>17</td>
                  <td>22.7</td>
                  <td>77</td>
                  <td>24.9</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>Wendys</td>
                  <td>13</td>
                  <td>17.3</td>
                  <td>39</td>
                  <td>12.6</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>ownership</td>
                  <td>Franchise</td>
                  <td>49</td>
                  <td>65.3</td>
                  <td>201</td>
                  <td>65.0</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>Company</td>
                  <td>26</td>
                  <td>34.7</td>
                  <td>108</td>
                  <td>35.0</td>
                  <td></td>
                  <td></td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<ol start="2" type="1">
<li>Regression adjustment ATT estimate</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression adjustment</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DRDID)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>fte_post <span class="ot">&lt;-</span> fastfood<span class="sc">$</span>fte_post</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>chain_name, <span class="at">data =</span> fastfood)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(fastfood<span class="sc">$</span>state <span class="sc">==</span> <span class="st">"New Jersey"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>unc_att <span class="ot">&lt;-</span> DRDID<span class="sc">::</span><span class="fu">reg_did_panel</span>(<span class="at">y1 =</span> fte_post, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">D =</span> D, <span class="at">covariates =</span> covs)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>unc_att</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Call:
DRDID::reg_did_panel(y1 = fte_post, y0 = 0, D = D, covariates = covs)
------------------------------------------------------------------
 Outcome-Regression DID estimator for the ATT:
 
   ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] 
  0.5969     0.8762     0.6812     0.4957    -1.1205     2.3143  
------------------------------------------------------------------
 Estimator based on panel data.
 Outcome regression est. method: OLS.
 Analytical standard error.
------------------------------------------------------------------
 See Sant'Anna and Zhao (2020) for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single regression</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>unc_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte_post <span class="sc">~</span> D <span class="sc">+</span> chain_name, <span class="at">data =</span> fastfood)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(unc_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fte_post ~ D + chain_name, data = fastfood)

Residuals:
    Min      1Q  Median      3Q     Max 
-24.312  -4.563  -0.927   3.548  38.299 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           23.8764     1.0699  22.316  &lt; 2e-16 ***
D                      0.4357     1.0670   0.408 0.683251    
chain_nameKFC        -10.8346     1.1393  -9.510  &lt; 2e-16 ***
chain_nameRoy Rogers  -3.6110     1.0758  -3.357 0.000869 ***
chain_nameWendys      -1.3138     1.3212  -0.994 0.320672    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.266 on 379 degrees of freedom
Multiple R-squared:  0.1984,    Adjusted R-squared:  0.1899 
F-statistic: 23.45 on 4 and 379 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Placebo test in pre-treatment period</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression adjustment placebo</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fte_pre <span class="ot">&lt;-</span> fastfood<span class="sc">$</span>fte_pre</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>unc_placebo <span class="ot">&lt;-</span> DRDID<span class="sc">::</span><span class="fu">reg_did_panel</span>(<span class="at">y1 =</span> fte_pre, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">D =</span> D, <span class="at">covariates =</span> covs)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>unc_placebo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Call:
DRDID::reg_did_panel(y1 = fte_pre, y0 = 0, D = D, covariates = covs)
------------------------------------------------------------------
 Outcome-Regression DID estimator for the ATT:
 
   ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] 
  -1.899     1.1865    -1.6004     0.1095    -4.2246     0.4267  
------------------------------------------------------------------
 Estimator based on panel data.
 Outcome regression est. method: OLS.
 Analytical standard error.
------------------------------------------------------------------
 See Sant'Anna and Zhao (2020) for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single regression placebo</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>unc_placebo_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte_pre <span class="sc">~</span> D <span class="sc">+</span> chain_name, <span class="at">data =</span> fastfood)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(unc_placebo_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fte_pre ~ D + chain_name, data = fastfood)

Residuals:
    Min      1Q  Median      3Q     Max 
-17.302  -5.468  -1.616   3.238  62.913 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            25.642      1.145  22.394   &lt;2e-16 ***
D                      -2.340      1.142  -2.049   0.0411 *  
chain_nameKFC         -11.186      1.219  -9.174   &lt;2e-16 ***
chain_nameRoy Rogers   -1.215      1.151  -1.055   0.2920    
chain_nameWendys       -1.137      1.414  -0.804   0.4217    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.846 on 379 degrees of freedom
Multiple R-squared:  0.2058,    Adjusted R-squared:  0.1974 
F-statistic: 24.55 on 4 and 379 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Lagged outcome unconfoundedness ATT estimate</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression adjustment</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lou_covs <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> chain_name <span class="sc">+</span> fte_pre, <span class="at">data =</span> fastfood)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>lou_att_post <span class="ot">&lt;-</span> DRDID<span class="sc">::</span><span class="fu">reg_did_panel</span>(<span class="at">y1 =</span> fte_post, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">D =</span> D, <span class="at">covariates =</span> lou_covs)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>lou_att_post</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Call:
DRDID::reg_did_panel(y1 = fte_post, y0 = 0, D = D, covariates = lou_covs)
------------------------------------------------------------------
 Outcome-Regression DID estimator for the ATT:
 
   ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] 
  0.844      0.8903     0.948      0.3431    -0.9009     2.5889  
------------------------------------------------------------------
 Estimator based on panel data.
 Outcome regression est. method: OLS.
 Analytical standard error.
------------------------------------------------------------------
 See Sant'Anna and Zhao (2020) for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single regression</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>lou_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(fte_post <span class="sc">~</span> D <span class="sc">+</span> chain_name <span class="sc">+</span> fte_pre, <span class="at">data =</span> fastfood)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lou_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fte_post ~ D + chain_name + fte_pre, data = fastfood)

Residuals:
     Min       1Q   Median       3Q      Max 
-19.2840  -4.3720  -0.9191   3.1944  31.3946 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          12.95210    1.45332   8.912  &lt; 2e-16 ***
D                     1.43260    0.95619   1.498  0.13491    
chain_nameKFC        -6.06889    1.12243  -5.407 1.14e-07 ***
chain_nameRoy Rogers -3.09339    0.96013  -3.222  0.00138 ** 
chain_nameWendys     -0.82922    1.17844  -0.704  0.48208    
fte_pre               0.42603    0.04277   9.960  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.366 on 378 degrees of freedom
Multiple R-squared:  0.365, Adjusted R-squared:  0.3566 
F-statistic: 43.46 on 5 and 378 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Difference-in-differences ATT estimate</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression adjustment</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>did_att_post <span class="ot">&lt;-</span> DRDID<span class="sc">::</span><span class="fu">reg_did_panel</span>(<span class="at">y1 =</span> fte_post, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">D =</span> D, <span class="at">covariates =</span> covs)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>did_att_post</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Call:
DRDID::reg_did_panel(y1 = fte_post, y0 = 0, D = D, covariates = covs)
------------------------------------------------------------------
 Outcome-Regression DID estimator for the ATT:
 
   ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] 
  0.5969     0.8762     0.6812     0.4957    -1.1205     2.3143  
------------------------------------------------------------------
 Estimator based on panel data.
 Outcome regression est. method: OLS.
 Analytical standard error.
------------------------------------------------------------------
 See Sant'Anna and Zhao (2020) for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single regression</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fastfood<span class="sc">$</span>delta_fte <span class="ot">&lt;-</span> fastfood<span class="sc">$</span>fte_post <span class="sc">-</span> fastfood<span class="sc">$</span>fte_pre</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>did_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(delta_fte <span class="sc">~</span> D <span class="sc">+</span> chain_name, <span class="at">data =</span> fastfood)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(did_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = delta_fte ~ D + chain_name, data = fastfood)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.734  -3.861   0.564   4.277  33.167 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)           -1.7659     1.1570  -1.526   0.1278  
D                      2.7757     1.1539   2.405   0.0166 *
chain_nameKFC          0.3518     1.2321   0.286   0.7754  
chain_nameRoy Rogers  -2.3960     1.1634  -2.060   0.0401 *
chain_nameWendys      -0.1764     1.4288  -0.123   0.9018  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.938 on 379 degrees of freedom
Multiple R-squared:  0.02875,   Adjusted R-squared:  0.0185 
F-statistic: 2.804 on 4 and 379 DF,  p-value: 0.02564</code></pre>
</div>
</div>
</section>
<section id="coding-questions" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="coding-questions"><span class="header-section-number">18.5</span> Coding Questions</h2>
<ol type="1">
<li><p>For this problem, we will use the data <code>rand_hie</code>. This is data from the RAND health insurance experiment in the 1980s. In the experiment, participants were randomly assigned to get Catastrophic (the least amount of coverage), insurance that came with a Deductible, insurance that came with Cost Sharing (i.e., co-insurance so that an individual pays part of their medical insurance), and Free (so that there is no cost of medical care).</p>
<p>For this problem, we will be interested in whether or not changing the type of health insurance changed the amount of health care utilization and the health status of individuals.</p>
<p>We will focus on the difference between the least amount of health insurance (“Catastrophic”) and the most amount of health insurance (“Free”). In particular, you can start this problem by running the following code:</p>
<p><code>rand_hie_subset &lt;- subset(rand_hie, plan_type %in% c("Catastrophic", "Free"))</code> <code>rand_hie_subset$free &lt;- 1*(rand_hie_subset$plan_type=="Free")</code></p>
<p>This code creates a new data frame called <code>rand_hie_subset</code> that only contains individuals who were assigned to either the “Catastrophic” or “Free” plan types. It also creates a new variable called <code>free</code> that is equal to one for individuals who were assigned to the “Free” plan type and zero for individuals who were assigned to the “Catastrophic” plan type. Use this data frame for the rest of this problem.</p>
<ol type="a">
<li><p>Suppose you are interested in estimating the average treatment effect on the treated of the “Free” plan relative to the “Catastrophic” plan on total medical expenditure (<code>total_med_expenditure</code>). Can you estimate this effect by running a regression of <code>total_med_expenditure</code> on <code>free</code>? Explain why or why not.</p></li>
<li><p>Estimate the average treatment effect on the treated of a “Free” plan (<code>free</code>) relative to a “Catastrophic” plan on total medical expenditure (<code>total_med_expenditure</code>) Report and interpret your results.</p></li>
<li><p>Estimate the average treatment effect on the treated of a “Free” plan (<code>free</code>) relative to a “Catastrophic” plan on face to face doctor visits (<code>face_to_face_visits</code>) Report and interpret your results.</p></li>
<li><p>Estimate the average treatment effect on the treated of a “Free” plan (<code>free</code>) relative to a “Catastrophic” plan on overall health index (<code>health_index</code>) Report and interpret your results.</p></li>
<li><p>Provide an overall interpration of your results from parts b-d.</p></li>
</ol></li>
<li><p>For this problem, we will study the causal effect of having more children on women’s labor supply using the data <code>Fertility</code>. <!-- Note: use the version of this data from AER package going forward. --></p>
<ol type="a">
<li><p>To start with, run a regression of the number of hours that a woman typically works per week (<code>work</code>) on whether or not she has more than two children (<code>morekids</code>). Report your results. Should you interpret the estimated coefficient on <code>morekids</code> as the causal effect of having more than two children? Explain.</p></li>
<li><p>One possible instrument in this setup is the sex composition of the first two children (i.e., whether they are both girls, both boys, or a boy and a girl). The thinking here is that, at least in the United States, parents tend to have a preference for having both a girl and a boy and that, therefore, parents whose first two children have the same sex may be more likely to have a third child than they would have been if they have a girl and a boy. Go through the lise of four assumptions that we discussed in the context of instrumental variables and provide some discussion about whether or not each of these assumptions are likely to hold in this context.</p></li>
<li><p>Regardless of your answer to part (b), create a new variable called <code>samesex</code> that is equal to one for families whose first two children have the same sex. Estimate the effect of <code>morekids</code> on <code>work</code> using <code>samesex</code> as an instrument for <code>morekids</code> and report the results. Provide some discussion about your results.</p></li>
</ol></li>
<li><p>For this question, we will use the <code>AJR</code> data. A deep question in development economics is: Why are some countries much richer than other countries? One explanation for this is that richer countries have different institutions (e.g., property rights, democracy, etc.) that are conducive to growth. Its hard to study these questions though because institutions do not arise randomly — there could be reverse causality so that property rights, democracy, etc. are (perhaps partially) caused by being rich rather than the other way around. Alternatively, other factors (say a country’s geography) could cause both of these. We’ll consider one instrumental variables approach to thinking about this question in this problem.</p>
<ol type="a">
<li><p>Run a regression of the log of per capita GDP (the log of per capita GDP is stored in the variable <code>GDP</code>) on a measure of the protection against expropriation risk (this is a measure of how “good” a country’s institutions are (a larger number indicates “better” institutions) and it is in the variable <code>Exprop</code>). How do you interpret these results? Do you think it would be reasonable to interpret the estimated coefficient on <code>Exprop</code> as the causal effect of institutions on GDP.</p></li>
<li><p>One possible instrument for <code>Exprop</code> is settler mortality (we’ll use the log of this which is available in the variable <code>logMort</code>). Settler mortality is a measure of how dangerous it was for early settlers of a particular location. The idea is that places that have high settler mortality may have set up worse (sometimes called “extractive”) institutions than places that had lower settler mortality. But that settler mortality (from a long time ago) does not have any other direct effect on modern GDP. Provide some discussion about whether settler mortality is a valid instrument for institutions.</p></li>
<li><p>Estimate an IV regression of <code>GDP</code> on <code>Exprop</code> using <code>logMort</code> as an instrument for <code>Exprop</code>. How do you interpret the results? How do these results compare to the ones from part a?</p></li>
</ol></li>
<li><p>For this question, we’ll use the data <code>house</code> to study the causal effect of incumbency on the probability that a member of the House of Representatives gets re-elected. <!-- Note: better data from ivmte package --></p>
<ol type="a">
<li><p>One way to try to estimate the causal effect of incumbency is to just run a regression where the outcome is <code>democratic_vote_share</code> (this is the same outcome we’ll use below) and where the model includes a binary variable for whether or not the democratic candidate is an incumbent. What are some limitions of this strategy?</p></li>
<li><p>The <code>house</code> data contains data about the margin of victory (is positive if they won the election and negative if they lost) for Democratic candidates in the current election and data about the Democratic margin of victory in the past election. Explain how you could use this data in a regression discontinuity design to estimate the causal effect of incumbency.</p></li>
<li><p>The main assumption to rationalize a regression discontinuity design is the continuity assumption. Explain what this assumption means in the context of the regression discontinuity design that you proposed in part b. Do you think that this assumption is likely to hold in this context? Why or why not?</p></li>
<li><p>Use the <code>house</code> data to implement the regression discontinuity design that you proposed in part b. What do you estimate as the causal effect of incumbency?</p></li>
</ol></li>
<li><p>For this problem, we will use the data <code>banks</code>. We will study the causal effect of monetary policy on bank closures during the Great Depression. We’ll consider an interesting natural experiment in Mississippi where half the northern half of the state was in St.&nbsp;Louis’s federal reserve district (District 8) and the southern half of the state was in Atlanta’s federal reserve district (District 6). Atlanta had much looser monetary policy (meaning they substantially increased lending) than St.&nbsp;Louis during the early part of the Great Depression and our interest is in whether looser monetary policy made an difference.</p>
<ol type="a">
<li><p>Plot the total number of banks separately for District 6 and District 8 across all available time periods in the data.</p></li>
<li><p>An important event in the South early in the Great Depression was the collapse of Caldwell and Company — the largest banking chain in the South at the time. This happened in November 1930. The Atlanta Fed’s lending markedly increased quickly after this event while St.&nbsp;Louis’s did not. Calculate a DID estimate of the effect of looser monetary policy on the number of banks that are still in business. How do you interpret these results? <strong>Hint:</strong> You can calculate this by taking the difference between the number of banks in District 6 relative to the number of banks in District 8 across all time periods relative to the difference between the number of banks in District 6 relative to District 8 in the first period (July 1, 1929).</p></li>
</ol></li>
</ol>
</section>
<section id="extra-questions" class="level2" data-number="18.6">
<h2 data-number="18.6" class="anchored" data-anchor-id="extra-questions"><span class="header-section-number">18.6</span> Extra Questions</h2>
<ol type="1">
<li><p>What is the difference between treatment effect homogeneity and treatment effect heterogeneity?</p></li>
<li><p>Why do most researchers give up on trying to estimate the individual-level effect of participating in a treatment?</p></li>
<li><p>What are four conditions for a valid instrument? Explain in words and math.</p></li>
<li><p>Explain what unconfoundedness means.</p></li>
<li><p>If we make the assumption of unconfoundedness, explain in words what sort of comparisons that we would like to make in order to estimate the average treatment effect on the treated.</p></li>
<li><p>What is the key condition underlying a difference-in-differences approach to learn about the causal effect of some treatment on some outcome? Explain both in words and in math. In what circumstance would a researcher be likely to prefer this type of assumption over unconfoundedness?</p></li>
<li><p>Suppose you are interested in the causal effect of participating in a union on a person’s income. Consider the following approaches.</p>
<ol type="a">
<li><p>Consider the following assumption: <span class="math display">\[\begin{align*}
   \big(Earnings(1), Earnings(0)\big) \independent Union | Education
\end{align*}\]</span> where <span class="math inline">\(Earnings(1)\)</span> is the potential earnings if the individual participates in a union, <span class="math inline">\(Earnings(0)\)</span> is the potential earnings if the individual does not participate in a union, <span class="math inline">\(Union\)</span> is a binary variable equal to one if the individual participates in a union and zero otherwise, and <span class="math inline">\(Education\)</span> is years of education. Do you think this assumption is likely to hold? Explain.</p></li>
<li><p>Regardless of your answer to part (a), explain how to estimate the ATT of participating in a union on earnings under the assumption in part (a) using regression adjustment.</p></li>
<li><p>Regardless of your answer to part (a), explain how to estimate the ATT of participating in a union on earnings under the assumption in part (a) using a single regression. What additional assumption do you need to make in order to use this approach?</p></li>
<li><p>Now suppose that you have access to two periods of panel data. Suppose that we are looking at a population of adults, so we can assume that each person’s education is constant over time. Also, suppose that no one participated in a union in the first period (note: this is probably unrealistic, but we could just drop all observations that participated in a union in the first period). How can you use this data to conduct a placebo test for the unconfoundedness assumption in part (a)? Why is this useful?</p></li>
<li><p>Consider the same setup at in part (d). Explain the assumption of lagged outcome unconfoundedness in this context. Do you think this assumption is likely to hold? Explain.</p></li>
<li><p>Regardless of your answer to part (d), explain how to estimate the ATT of participating in a union on earnings under the assumption in part (d) using regression adjustment and then using a single regression.</p></li>
<li><p>Now, suppose that we are willing to make the parallel trends assumption. Explain what this assumption means in this context. Do you think this assumption is likely to hold? Explain.</p></li>
<li><p>Regardless of your answer to part (f), explain how to estimate the ATT of participating in a union on earnings under the assumption in part (f) using regression adjustment and then using a single regression.</p></li>
<li><p>Given the setup with two periods of panel data, is it possible to conduct a placebo test for lagged outcome unconfoundedness or difference-in-differences? Does your answer change if you had access to three periods of panel data? Explain.</p></li>
</ol></li>
<li><p>Suppose that you are interested in learning about the causal effect of attending college on earnings.</p>
<ol type="a">
<li><p>You read a newspaper article that says that the average earnings for college graduates is $50,000 per year while the average earnings for non-college graduates is $40,000 per year. The article interprets this $10,000 difference as the return to attending college. What assumption would you need to believe in order for this interpretation to be valid? Do you think this assumption is likely to hold? Explain.</p></li>
<li><p>Regardless of your actual answer to part (a), suppose that you are not willing to believe the assumption that you mentioned there. You remember that having access to an instrumental variable is useful for learning about causal effects, and your friend suggests generating an instrument <span class="math inline">\(Z\)</span> by randomly drawing a 1 or a 0 for each individual in your data. Go through the four conditions that we discussed for a valid instrument and explain whether or not each of these conditions is likely to hold for this instrument.</p></li>
<li><p>You also notice that you have a variable in your data that indicates whether or not an individual grew up near a college (<code>near_college</code>). Another friend suggests using this variable as an instrument for attending college. Go through the four conditions that we discussed for a valid instrument and explain whether or not each of these conditions is likely to hold for this instrument.</p></li>
</ol></li>
<li><p>Suppose that you are interested in the effect of lower college costs on the probability of graduating from college. You have access to student-level data from Georgia where students are eligible for the Hope Scholarship if they can keep their GPA above 3.0.</p>
<ol type="a">
<li><p>What strategy can use to exploit this institional setting to learn about the causal effect of lower college costs on the probability of going to college?</p></li>
<li><p>What sort of data would you need in order to implement this strategy?</p></li>
<li><p>Can you think of any ways that the approach that you suggested could go wrong?</p></li>
<li><p>Another researcher reads the results from the approach you have implemented and complains that your results are only specific to students who have grades right around the 3.0 cutoff. Is this a fair criticism?</p></li>
</ol></li>
<li><p>Suppose you are willing to believe versions of unconfoundedness, a linear model for untreated potential outcomes, and treatment effect homogeneity so that you could write <span class="math display">\[\begin{align*}
  Y_i = \beta_0 + \alpha D_i + \beta_1 X_i + \beta_2 W_i + U_i
\end{align*}\]</span> with <span class="math inline">\(\E[U|D,X,W] = 0\)</span> so that you were willing to interpret <span class="math inline">\(\alpha\)</span> in this regression as the causal effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span>. However, suppose that <span class="math inline">\(W\)</span> is not observed so that you cannot operationalize the above regression.</p>
<ol type="a">
<li><p>Since you do not observe <span class="math inline">\(W\)</span>, you are considering just running a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(D\)</span> and <span class="math inline">\(X\)</span> and interpreting the estimated coefficient on <span class="math inline">\(D\)</span> as the causal effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span>. Does this seem like a good idea?</p></li>
<li><p>In part (a), we can write a version of the model that you are thinking about estimating as <span class="math display">\[\begin{align*}
  Y_i = \delta_0 + \delta_1 D_i + \delta_2 X_i + \epsilon_i
\end{align*}\]</span> Suppose that <span class="math inline">\(\E[\epsilon | D, X] = 0\)</span> and suppose also that <span class="math display">\[\begin{align*}
W_i = \gamma_0 + \gamma_1 D_i + \gamma_2 X_i + V_i
\end{align*}\]</span> with <span class="math inline">\(\E[V|D,X]=0\)</span>. Provide an expression for <span class="math inline">\(\delta_1\)</span> in terms of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\gamma\)</span>’s and <span class="math inline">\(\beta\)</span>’s. Explain what this expression means.</p></li>
</ol></li>
<li><p>Suppose you have access to an experiment where some participants were randomly assigned to participate in a job training program and others were randomly assigned not to participate. However, some individuals that were assigned to participate in the treatment decided not to actually participate. Let’s use the following notation: <span class="math inline">\(D=1\)</span> for individuals who actually participated and <span class="math inline">\(D=0\)</span> for individuals who did not participate. <span class="math inline">\(Z=1\)</span> for individuals who were assigned to the treatment and <span class="math inline">\(Z=0\)</span> for individuals assigned not to participate (here, <span class="math inline">\(D\)</span> and <span class="math inline">\(Z\)</span> are not exactly the same because some individuals who were assigned to the treatment did not actually participate).</p>
<p>You are considering several different approaches to dealing with this issue.</p>
<ol type="a">
<li><p>Estimating <span class="math inline">\(ATT\)</span> by <span class="math inline">\(\bar{Y}_{D=1} - \bar{Y}_{D=0}\)</span>. What condition do you need to believe in order for this approach to deliver a valid estimate of the <span class="math inline">\(ATT\)</span>? Does this condition seem likely to hold in this context? Explain.</p></li>
<li><p>Run the regression <span class="math inline">\(Y_i = \beta_0 + \alpha D_i + U_i\)</span> using <span class="math inline">\(Z_i\)</span> as an instrument. Go through the conditions for a valid instrument and explain whether or not each of these conditions is likely to hold in this context. Assuming that all four conditions hold, how do you interpret the estimated coefficient on <span class="math inline">\(D\)</span> in this regression?</p></li>
</ol></li>
<li><p>Suppose you and a friend have conducted an experiment (things went well so that everyone complied with the treatment that they were assigned to, etc.). You interpret the difference <span class="math inline">\(\bar{Y}_{D=1} - \bar{Y}_{D=0}\)</span> as an estimate of the <span class="math inline">\(ATT\)</span>, but your friend says that you should interpret it as an estimate of the <span class="math inline">\(ATE\)</span>. In fact, according to your friend, random treatment assignment implies that <span class="math display">\[\begin{align*}
  &amp; \E[Y(1)] = \E[Y(1)|D=1] = \E[Y|D=1] \\
  \text{ and } &amp; \E[Y(0)] = \E[Y(0)|D=0] = \E[Y|D=0]
\end{align*}\]</span> which implies that <span class="math inline">\(ATE = \E[Y|D=1] - \E[Y|D=0]\)</span>. Who is right?</p></li>
</ol>
<!--
## Answers to Some Extra Questions

**Answer to Question 4**

The key condition is the parallel trends assumption that says that, in the absence of participating in the treatment, the *path* of outcomes that individuals in the treated group is the same, on average, as the path of outcomes that individuals in the untreated group actually experienced.

**Answer to Question 9**

a) When some individuals do not comply with their treatment assignment, this approach is probably not so great.  In particular, notice that the comparison in this part of the problem is among individuals who *actually* participated in the treatment relative to those who didn't (the latter group includes both those assigned not to participate in the treatment along with those assigned to participate in the treatment, but ultimately didn't actually participate).  This suggests that this approach would generally lead to biased estimates of the $ATT$.  In the particular context of job training, you can see this would not be such a good idea if, for example, the people who were assigned to the job training program but who did not participate tended to do this because they were able to find a job before the job training program started.

b) This approach is likely to be better.  By construction, $Z$ is not correlated with $U$ (since $Z$ is randomly assigned).  $Z$ is also likely to be positively correlated with $Z$ (in particular, this will be the case if being randomly assigned to treatment increases the probability of being treated).  This implies that $Z$ is a valid instrument and should be able to deliver a reasonable estimate of the effect of participating in the treatment.

**Answer to Question 10**

While your friend's explanation is not technically wrong, it seems to me that you are more right than your friend.  There is an important issue related to external validity here.  The group of people that show up to participate in the experiment could be (and likely are) quite different from the general population.  Interpreting the results of the experiment as being an $ATE$ (in the sense of across the entire population) is therefore likely to be incorrect --- or at least would require extra assumptions and/or justifications.  Interpreting them as an $ATT$ (i.e., as the effect among those who participated in the treatment) is still perfectly reasonable though.
-->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./16-natural_experiments.html" class="pagination-link  aria-label=" &lt;span="" experiments&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Natural Experiments</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>